<p id="notice"><%= notice %></p>

<%= form_for(@pictograph, :html => {:class => 'form-horizontal picto-form', :multipart => true}) do |f| %>
  <% if @pictograph.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@pictograph.errors.count, "error") %> prohibited this pictograph from being saved:</h2>

      <ul>
      <% @pictograph.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <h3 style="width: <%=@pictograph.table_width%>px; margin-left: <%=@pictograph.axis_width + 25 %>px; margin-bottom: -30px;">
		<%= f.text_field :title, {:placeholder => 'Click to edit title', :class => 'hide editor', :id => "pictograph_title"} %><%=link_to 'ok', "#", {:id => "pictograph_title_submit", :class => 'btn hide submittable'}%><%=link_to @pictograph.title || 'Click to edit title', "#pictograph_title", {:class => "editable"} %>
  </h3>

	<%= render 'graph' %>

	<div id="editor">
			<ul class="nav nav-tabs">
				<% @pictograph.risks.each_with_index do |risk, i| %>
					<li class='<%="active" if i == 1 %> color-tab'><a href="#color<%=i%>" data-toggle="tab" style="background-color: <%=@pictograph.risks[i].hex%>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></li>
				<% end %>
				<% if @advanced %>
					<li id="new-risk"><%=link_to '+', new_risk_path(:tab => @pictograph.risks.length), {:remote => true}%></li>
					<li><a href="#fine-tuning" data-toggle="tab" style="border-color: #ddd; border-width: 1px 1px 0px 1px;">fine-tuning</a></li>
				<% end %>
			</ul>

			<div class="tab-content">
				<% i = 0 %>	  
				<%= f.fields_for :risks do |r| %>
					<%= render '/risks/form', :r => r, :i => i %>
					<% i += 1 %>
				<% end %>

			
			<div class="tab-pane" id="fine-tuning">
				<fieldset id="cells">
					<legend>Cells</legend>
				  <div class="field">
				    <%= f.label :cell_width %>
				    <%= f.number_field :cell_width, {:class => 'span1'} %>
				  </div>
				  <div class="field">
				    <%= f.label :cell_height %>
				    <%= f.number_field :cell_height, {:class => 'span1'} %>
				  </div>
				  <div class="field">
				    <%= f.label :cell_spacing %>
				    <%= f.number_field :cell_spacing, {:class => 'span1'} %>
				  </div>
				  <div class="field">
				    <%= f.label :cols %>
				    <%= f.number_field :cols, {:class => 'span1'} %>
				  </div>
				  <div class="field">
				    <%= f.label :rows %>
				    <%= f.number_field :rows, {:class => 'span1'} %>
				  </div>
				</fieldset>
				
				<fieldset id="axis">
					<legend>Axis</legend>
				  <div class="field checkbox">
				    <%= f.check_box :axis_labels %> <%= f.label :axis_labels %> 
				  </div>
				  <div class="field radio">
				    <%= f.label :axis_position_left, 'left' %><%= f.radio_button :axis_position, 'left' %><br />
						<%= f.label :axis_position_right, 'right' %><%= f.radio_button :axis_position, 'right' %>
				  </div>
				  <div class="field">
				    <%= f.label :axis_font %>
				    <%= f.text_field :axis_font %>
				  </div>
				  <div class="field">
				    <%= f.label :axis_font_size %>
				    <%= f.number_field :axis_font_size, {:class => 'span1'} %>px
				  </div>
				</fieldset>
			</div>
			
			
		</div><!-- End tab content -->
		<p class="help hide" id="value-help">
		  Click on any square/icon in the array to set the risk, or just set the number here.
		</p>
		
	</div>

	<br clear="left" />
	
  <div class="actions">
    <!-- <%= f.submit "Save" %>-->
		<%= f.submit 'preview', {:class => 'btn btn-primary'} %>
		<%=link_to 'save as link', '#save-share', {:class => 'btn'} %> <%=link_to 'embed', '#embed', {:class => 'btn'} %> <%= f.submit 'export for web', {:class => 'btn'} %> <%= f.submit 'export for print', {:class => 'btn'} %>
  </div>

	<div class="modal" id="save-share">
	  <div class="modal-header">
	    <a class="close" data-dismiss="modal">×</a>
	    <h3>Save/Share this Icon Array</h3>
	  </div>
	  <div class="modal-body">
	    <p>Here is the URL <%=request.url%></p>
	  </div>
	  <div class="modal-footer">
	    <a href="#" data-dismiss="modal" class="btn">Close</a>
	  </div>
	</div>
	
	<div class="modal" id="embed">
	  <div class="modal-header">
	    <a class="close" data-dismiss="modal">×</a>
	    <h3>Embed this Icon Array</h3>
	  </div>
	  <div class="modal-body">
	    <p id="embed-code"></p>
	  </div>
	  <div class="modal-footer">
			<a href="#embed-code" class="zclip" data-copied-hint="copied!" data-copy-hint="copy to clipboard">Copy to Clipboard</a>
	  	<a href="#" data-dismiss="modal" class="btn">Close</a>
	  </div>
	</div>

<% end %>
